---
layout: default
---

<article class="page research-note">
  <header class="page__header">
    <h1 class="page__title">{{ page.title | escape }}</h1>
    {% if page.date %}
      <p class="page__meta muted small">{{ page.date | date: "%-d %b %Y" }}</p>
    {% endif %}
  </header>

  <div class="content">
    {{ content }}
  </div>

  {% comment %}
  Theme links are defined in front matter:
  - series: list of series references (string series_id/slug, or object with series_id + optional label)
  - research-notes: list of research note references (string slug, or object with research_id + optional label)
  {% endcomment %}

  {%- assign has_series = false -%}
  {%- assign has_research = false -%}

  {%- if page.series and page.series != empty -%}
    {%- assign has_series = true -%}
  {%- endif -%}

  {%- if page["research-notes"] and page["research-notes"] != empty -%}
    {%- assign has_research = true -%}
  {%- endif -%}
  {% if has_series or has_research %}    <!-- only show section if there are supplements -->
    <hr>
    <section class="supplements">
      <h2 class="visually-hidden">Links</h2>

      {%- if has_series -%}
        <div class="supplements__links">
          <h3>works</h3>
          <div class="index">
          {% for item in page.series %}
            {% assign series_ref = item.series_id | default: item %}
            {% assign series_doc = site.series | where: "series_id", series_ref | first %}
            {% if series_doc == nil %}
              {% assign series_doc = site.series | where: "slug", series_ref | first %}
            {% endif %}
            {% if series_doc %}
              {% include series_index_item.html series=series_doc %}
            {% else %}
              {% assign text = item.label | default: series_ref %}
              <p class="supplements__link supplements__link--html">{{ text | escape }}</p>
            {% endif %}
          {% endfor %}
          </div>
        </div>
      {% endif %}

      {%- if has_research -%}
        <div class="supplements__links">
          <h3>research</h3>
          <div class="index">
          {% for item in page["research-notes"] %}
            {% assign note_ref = item.research_id | default: item.slug | default: item %}
            {% assign note_doc = site.research | where: "slug", note_ref | first %}
            {% if note_doc == nil %}
              {% assign note_doc = site.research | where: "research_id", note_ref | first %}
            {% endif %}
            {% if note_doc %}
              {% include research_index_item.html note=note_doc %}
            {% else %}
              {% assign text = item.label | default: note_ref %}
              <p class="supplements__link supplements__link--pdf">{{ text | escape }}</p>
            {% endif %}
          {% endfor %}
          </div>
        </div>
      {% endif %}
      
    </section>
  {% endif %}
</article>
