---
layout: default
---

{% assign wid = page.work_id | default: page.slug %}
{%- assign title_txt = page.title | default: "" | strip -%}

{% assign media_base = site.media_base | default: "" %}
{% assign media_prefix = site.media_prefix | default: "/assets" %}
{% assign works_img_prefix = media_prefix | append: "/works/img" %}
{% assign works_files_prefix = media_prefix | append: "/works/files" %}
{% assign img_base = media_base | append: works_img_prefix | append: "/" %}
{% assign files_base = media_base | append: works_files_prefix | append: "/" %}

{%- assign src800  = img_base | append: wid | append: "-primary-800.webp" -%}
{%- assign src1200 = img_base | append: wid | append: "-primary-1200.webp" -%}
{%- assign src1600 = img_base | append: wid | append: "-primary-1600.webp" -%}
{%- assign src2400 = img_base | append: wid | append: "-primary-2400.webp" -%}

{%- unless img_base contains '://' -%}
  {%- assign src800  = src800  | relative_url -%}
  {%- assign src1200 = src1200 | relative_url -%}
  {%- assign src1600 = src1600 | relative_url -%}
  {%- assign src2400 = src2400 | relative_url -%}
{%- endunless -%}

<article class="page work">

  <h1 class="visually-hidden">{% if title_txt != "" %}{{ title_txt }}{% else %}Untitled{% endif %}</h1>

  <!-- Series navigation:
     - If URL has ?series=series_id, try to load that series' work IDs from JSON.
     - If successful, show Prev/Next links for navigating within that series.
     - Otherwise hide the nav. -->
  <nav class="seriesNav" id="seriesNav"
      aria-label="Series navigation"
      data-work-id="{{ page.work_id | escape }}"
      hidden>
    <a class="seriesNav__prev" id="seriesNavPrev" href="#">←</a>
    <a class="seriesNav__next" id="seriesNavNext" href="#">→</a>
  </nav>

  <figure class="page__media">
    <a class="page__mediaLink"
      href="{{ src2400 }}" target="_blank" rel="noopener"
      style="--work-ar: {{ page.width_cm | default: 4 }} / {{ page.height_cm | default: 3 }};">
      <img
        class="page__mediaImg"
        src="{{ src1600 }}"
        srcset="
          {{ src800 }} 800w,
          {{ src1200 }} 1200w,
          {{ src1600 }} 1600w,
          {{ src2400 }} 2400w"
        sizes="(max-width: 800px) 100vw, 72ch"
        alt="{{ title_txt | default: 'Artwork' | escape }}"
        loading="eager"
        fetchpriority="high"
        decoding="async"
        style="width:100%;height:auto;display:block;">
    </a>
  </figure>

  <section class="page__meta page__media">
    <h2 class="visually-hidden">Details</h2>

    <div class="page__caption">
      <div class="page__row work__titleRow">{% if title_txt != "" %}{{ title_txt }}{% else %}Untitled{% endif %}</div>

      {% if page.year_display %}
        <div class="page__row">{{ page.year_display }}</div>
      {% endif %}

      {% if page.medium_caption %}
        <div class="page__row">{{ page.medium_caption }}</div>
      {% endif %}

      {% if page.duration %}
        <div class="page__row">{{ page.duration }}</div>
      {% endif %}

      {% if page.height_cm or page.width_cm or page.depth_cm %}
        <div class="page__row">
          {% if page.height_cm and page.width_cm %}
            {{ page.height_cm }} × {{ page.width_cm }}{% if page.depth_cm %} × {{ page.depth_cm }}{% endif %} cm
          {% elsif page.height_cm %}
            {{ page.height_cm }} cm
          {% elsif page.width_cm %}
            {{ page.width_cm }} cm
          {% endif %}
        </div>
      {% endif %}

      {% if page.work_id %}
        <div class="page__row">cat. {{ page.work_id }}</div>
      {% endif %}
    </div>
  </section>

  <!-- supplementary images gallery -->
  {% if page.images and page.images.size > 0 %}
    <section class="supplements">
      <ul class="supplements__list">
        {% for img in page.images %}
          <li class="supplements__item">
            {% assign img_file = img.file | remove_first: '/' %}
            {% assign img_src = img_base | append: img_file %}
            {% unless img_base contains '://' %}{% assign img_src = img_src | relative_url %}{% endunless %}
            <img
              src="{{ img_src }}"
              alt="{{ img.alt | default: img.caption | default: page.title | escape }}"
              loading="lazy"
              decoding="async"
              style="max-width:100%;height:auto;display:block;">
            <!-- image caption not currently used (need to migrate to a grid + lightbox)-->
            <!-- {% if img.caption %}<div>{{ img.caption }}</div>{% endif %} -->
          </li>
        {% endfor %}
      </ul>
    </section>
  {% endif %}

  <!-- for other file types (PDFs, text files, etc.) -->
  {% if page.attachments and page.attachments.size > 0 %}
    <section class="supplements">
      <ul class="supplements__list">
        {% for a in page.attachments %}
          {% if a.file %}
            {% assign href = a.file %}
            {% unless href contains '://' %}
              {% assign href_file = href | remove_first: '/' %}
              {% assign href = files_base | append: href_file %}
              {% unless files_base contains '://' %}
                {% assign href = href | relative_url %}
              {% endunless %}
            {% endunless %}
            <li class="supplements__item"><a class="supplements__link supplements__link--pdf" href="{{ href }}">{{ a.label | default: "Download" }}</a></li>
          {% endif %}
        {% endfor %}
      </ul>
    </section>
  {% endif %}

  <nav class="page__nav">
    <!-- Defaults to works index; upgraded to history-back when appropriate via script below. -->
    <a class="page__back" href="{{ '/works/' | relative_url }}" data-fallback="{{ '/works/' | relative_url }}">← index</a>
  </nav>

</article>

<!-- Smart back/index:
     - If the user navigated here from another page (same-origin referrer or non-trivial history), show "← back" and use history.back().
     - Otherwise keep "← index" linking to /works/. -->
<script>
  (function () {
    var link = document.querySelector('.page__back');
    if (!link) return;

    // If this work is being viewed in a series context (?series=...), the back link should
    // return to that series page rather than using history.back().
    var params = new URLSearchParams(window.location.search);
    var series = params.get('series');

    var baseurl = "{{ site.baseurl | default: '' }}".replace(/\/$/, '');
    var worksIndex = link.getAttribute('data-fallback') || link.getAttribute('href') || '/works/';

    if (series) {
      var seriesHref = baseurl + '/series/' + encodeURIComponent(series) + '/';
      link.textContent = '← series';
      link.setAttribute('href', seriesHref);
      return;
    }

    // Otherwise: if the user navigated here from another page (same-origin referrer or non-trivial history),
    // show "← back" and use history.back(). If not, keep "← index" linking to /works/.
    var ref = document.referrer || '';
    var sameOriginReferrer = ref && ref.indexOf(window.location.origin) === 0;
    var hasHistory = window.history.length > 1;

    if (sameOriginReferrer || hasHistory) {
      link.textContent = '← back';
      link.addEventListener('click', function (e) {
        e.preventDefault();
        window.history.back();
      });
      // Keep href as the index fallback (and for copy-link behaviour).
      link.setAttribute('href', worksIndex);
    } else {
      link.textContent = '← index';
      link.setAttribute('href', worksIndex);
    }
  })();
</script>

<script>
(function(){
  const params = new URLSearchParams(window.location.search);
  const series = params.get('series');
  if (!series) return; // direct visit / no context => hide nav

  const nav = document.getElementById('seriesNav');
  const prevA = document.getElementById('seriesNavPrev');
  const nextA = document.getElementById('seriesNavNext');
  if (!nav || !prevA || !nextA) return;

  const currentId = (nav.dataset.workId || '').trim();
  if (!currentId) return;

  const baseurl = "{{ site.baseurl | default: '' }}".replace(/\/$/, '');
  const jsonUrl = baseurl + "/assets/series/index/" + encodeURIComponent(series) + ".json";

  fetch(jsonUrl, { cache: "default" })
    .then(r => {
      if (!r.ok) throw new Error("HTTP " + r.status);
      return r.json();
    })
    .then(data => {
      // Accept either: ["00286","00361", ...] OR {work_ids:[...]} OR {items:[...]}
      let ids = [];
      if (Array.isArray(data)) ids = data;
      else if (data && Array.isArray(data.work_ids)) ids = data.work_ids;
      else if (data && Array.isArray(data.items)) ids = data.items;
      ids = ids.map(String);

      const i = ids.indexOf(currentId);
      if (i === -1 || ids.length < 2) return;

      // wrap-around: next from last => first; prev from first => last
      const prevId = ids[(i - 1 + ids.length) % ids.length];
      const nextId = ids[(i + 1) % ids.length];

      const qs = "?series=" + encodeURIComponent(series);
      prevA.href = baseurl + "/works/" + prevId + "/" + qs;
      nextA.href = baseurl + "/works/" + nextId + "/" + qs;

      nav.hidden = false;
    })
    .catch(() => {
      // Fail closed: hide nav if JSON missing/unreadable
      nav.hidden = true;
    });
})();
</script>