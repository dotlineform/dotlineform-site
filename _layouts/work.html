---
layout: default
---

{% assign wid = page.work_id | default: page.slug %}
{%- assign title_txt = page.title | default: "" | strip -%}

{% assign media_base = site.media_base | default: "" %}
{% assign media_prefix = site.media_prefix | default: "/assets" %}
{% assign works_img_prefix = media_prefix | append: "/works/img" %}
{% assign img_base = media_base | append: works_img_prefix | append: "/" %}

{%- assign src800  = img_base | append: wid | append: "-primary-800.webp" -%}
{%- assign src1200 = img_base | append: wid | append: "-primary-1200.webp" -%}
{%- assign src1600 = img_base | append: wid | append: "-primary-1600.webp" -%}
{%- assign src2400 = img_base | append: wid | append: "-primary-2400.webp" -%}
{%- assign work_details_json_path = "/assets/works/index/" | append: wid | append: ".json" -%}
{%- assign work_details_json_file = site.static_files | where: "path", work_details_json_path | first -%}
{%- assign has_work_details_json = false -%}
{%- if work_details_json_file -%}
  {%- assign has_work_details_json = true -%}
{%- endif -%}
{%- assign src2400_path = "/assets/works/img/" | append: wid | append: "-primary-2400.webp" -%}
{%- assign has_local_2400 = false -%}
<!-- this existence check is local to Jekyll’s static files (/assets/...).
If you later serve images only from external media_base (CDN/R2), this check won’t know what exists remotely. -->
{%- assign maybe_2400 = site.static_files | where: "path", src2400_path | first -%}
{%- if maybe_2400 -%}
  {%- assign has_local_2400 = true -%}
{%- endif -%}
{%- assign has_2400 = has_local_2400 -%}
<!-- external-hosted 2400 images can be enabled via front matter even when local existence check is false. -->
{%- if page.has_primary_2400 == true -%}
  {%- assign has_2400 = true -%}
{%- endif -%}
{%- assign full_src = src1600 -%}
{%- if has_2400 -%}
  {%- assign full_src = src2400 -%}
{%- endif -%}

{%- unless img_base contains '://' -%}
  {%- assign src800  = src800  | relative_url -%}
  {%- assign src1200 = src1200 | relative_url -%}
  {%- assign src1600 = src1600 | relative_url -%}
  {%- assign src2400 = src2400 | relative_url -%}
{%- endunless -%}

<article class="page work">

  <h1 class="visually-hidden">{% if title_txt != "" %}{{ title_txt }}{% else %}Untitled{% endif %}</h1>

  <!-- Series navigation:
     - If URL has ?series=series_id, try to load that series' work IDs from JSON.
     - If successful, show Prev/Next links for navigating within that series.
     - Otherwise hide the nav. -->
  <nav class="seriesNav" id="seriesNav"
      aria-label="Series navigation"
      data-work-id="{{ page.work_id | escape }}"
      data-series="{{ page.series_id | default: '' | escape }}"
      data-baseurl="{{ site.baseurl | default: '' }}"
      hidden>
    <a class="seriesNav__prev" id="seriesNavPrev" href="#">←</a>
    <a class="seriesNav__next" id="seriesNavNext" href="#">→</a>
  </nav>

  <figure class="page__media">
    <!-- note: add debug-media-boxes to <a> to compare link vs image boxes -->
    <a class="page__mediaLink"
      href="{{ full_src }}" target="_blank" rel="noopener"
      style="--work-ar: {{ page.width_cm | default: 4 }} / {{ page.height_cm | default: 3 }};">
      <img
        class="page__mediaImg"
        src="{{ src1600 }}"
        srcset="
          {{ src800 }} 800w,
          {{ src1200 }} 1200w,
          {{ src1600 }} 1600w{% if has_2400 %},
          {{ src2400 }} 2400w{% endif %}"
        sizes="(max-width: 800px) 100vw, 72ch"
        alt="{{ title_txt | default: 'Artwork' | escape }}"
        loading="eager"
        fetchpriority="high"
        decoding="async"
        style="width:100%;height:auto;display:block;">
    </a>
  </figure>

  <section class="page__meta page__media">
    <h2 class="visually-hidden">work details</h2>

    <div class="page__caption">
      <div class="page__row work__titleRow">{% if title_txt != "" %}{{ title_txt }}{% else %}Untitled{% endif %}</div>

      {% if page.year_display %}
        <div class="page__row">{{ page.year_display }}</div>
      {% endif %}

      {% if page.medium_caption %}
        <div class="page__row">{{ page.medium_caption }}</div>
      {% endif %}

      {% if page.duration %}
        <div class="page__row">{{ page.duration }}</div>
      {% endif %}

      {% if page.height_cm or page.width_cm or page.depth_cm %}
        <div class="page__row">
          {% if page.height_cm and page.width_cm %}
            {{ page.height_cm }} × {{ page.width_cm }}{% if page.depth_cm %} × {{ page.depth_cm }}{% endif %} cm
          {% elsif page.height_cm %}
            {{ page.height_cm }} cm
          {% elsif page.width_cm %}
            {{ page.width_cm }} cm
          {% endif %}
        </div>
      {% endif %}

      {% if page.work_id %}
        <div class="page__row">
          cat. {{ page.work_id }}
          {% if page.series_id %}
            {% assign series_href = "/series/" | append: page.series_id | append: "/" %}
            {% assign series_label = page.series_title | default: page.series_id %}
            {% assign works_in_series = site.works | where: "series_id", page.series_id %}
            {% if works_in_series.size > 1 %}
              | <a class="work__seriesLink" href="{{ series_href | relative_url }}">{{ series_label }}</a>
            {% endif %}
          {% endif %}
        </div>
      {% endif %}
    </div>
  </section>

  <section
    id="workDetailsSection"
    class="workDetails"
    data-work-id="{{ wid | escape }}"
    data-baseurl="{{ site.baseurl | default: '' }}"
    data-media-base="{{ site.media_base | default: '' }}"
    data-media-prefix="{{ site.media_prefix | default: '/assets' }}"
    data-enable-hash-scroll="{{ site.enable_details_hash_scroll | default: true }}"
    data-has-details-json="{{ has_work_details_json }}"
    hidden
  >
    <h2 class="visually-hidden">Additional details</h2>
    <div id="workDetailsContent"></div>
  </section>

  <nav class="page__nav">
    {% assign back_series_label = page.series_title | default: page.series_id | default: "series" %}
    <a
      id="pageBackLink"
      class="page__back"
      href="{{ '/series/' | relative_url }}"
      data-fallback="{{ '/series/' | relative_url }}"
      data-baseurl="{{ site.baseurl | default: '' }}"
      data-series-label="{{ back_series_label | escape }}"
    >← index</a>
  </nav>

</article>

<script>
  (function () {
    var link = document.getElementById('pageBackLink');
    if (!link) return;

    var baseurl = String(link.getAttribute('data-baseurl') || '').replace(/\/$/, '');
    var fallback = link.getAttribute('data-fallback') || (baseurl + '/series/');
    var seriesLabel = (link.getAttribute('data-series-label') || 'series').trim();
    var params = new URLSearchParams(window.location.search);
    var series = (params.get('series') || '').trim();

    if (series) {
      link.textContent = '← ' + seriesLabel;
      link.setAttribute('href', baseurl + '/series/' + encodeURIComponent(series) + '/');
    } else {
      link.textContent = '← works';
      link.setAttribute('href', fallback);
    }
  })();
</script>
<script>
  (function () {
    var section = document.getElementById('workDetailsSection');
    var content = document.getElementById('workDetailsContent');
    if (!section || !content) return;

    var workId = String(section.getAttribute('data-work-id') || '').trim();
    var workTitle = {{ title_txt | jsonify }};
    if (!workId) return;

    var baseurl = String(section.getAttribute('data-baseurl') || '').replace(/\/$/, '');
    var mediaBase = String(section.getAttribute('data-media-base') || '').replace(/\/$/, '');
    var mediaPrefix = String(section.getAttribute('data-media-prefix') || '/assets').replace(/\/$/, '');
    var detailsImgBase = mediaBase ? (mediaBase + mediaPrefix + '/work_details/img/') : (baseurl + mediaPrefix + '/work_details/img/');
    var hasDetailsJson = String(section.getAttribute('data-has-details-json') || 'false') === 'true';
    if (!hasDetailsJson) return;
    var jsonUrl = baseurl + '/assets/works/index/' + encodeURIComponent(workId) + '.json';
    // Site-level toggle: when true, hash-based back-links from detail pages scroll
    // to the corresponding details section after async JSON content is inserted.
    var enableHashScroll = String(section.getAttribute('data-enable-hash-scroll') || 'true') !== 'false';

    function esc(s) {
      return String(s == null ? '' : s)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/\"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    function slug(s) {
      return String(s || '')
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/^-+|-+$/g, '');
    }

    function scrollToHashTarget() {
      if (!enableHashScroll) return;
      var raw = window.location.hash || '';
      if (!raw || raw.length < 2) return;
      var id = decodeURIComponent(raw.slice(1));
      var target = document.getElementById(id);
      if (!target) return;
      requestAnimationFrame(function () {
        target.scrollIntoView({ behavior: 'auto', block: 'start' });
      });
    }

    fetch(jsonUrl, { cache: 'default' })
      .then(function (r) {
        if (!r.ok) throw new Error('HTTP ' + r.status);
        return r.json();
      })
      .then(function (data) {
        var sections = (data && Array.isArray(data.sections)) ? data.sections : [];
        if (!sections.length) return;

        var html = '';
        sections.forEach(function (sec) {
          var label = String((sec && sec.project_subfolder) || '').trim();
          var secId = slug(label || 'details');
          var details = (sec && Array.isArray(sec.details)) ? sec.details : [];
          if (!details.length) return;

          html += '<section class=\"workDetails__group\" id=\"details-' + esc(secId) + '\">';
          html += '<h3 class=\"workDetails__title\">' + esc(label || 'Details') + '</h3>';
          html += '<div class=\"seriesGrid\" aria-label=\"details for ' + esc(label || 'details') + '\">';
          details.forEach(function (d) {
            var uid = String((d && d.detail_uid) || '').trim();
            if (!uid) return;
            var thumb96 = detailsImgBase + uid + '-thumb-96.webp';
            var thumb192 = detailsImgBase + uid + '-thumb-192.webp';
            var title = String((d && d.title) || uid).trim();
            var href = baseurl + '/work_details/' + encodeURIComponent(uid) + '/?from_work=' + encodeURIComponent(workId) + '&from_work_title=' + encodeURIComponent(workTitle || '') + '&section=' + encodeURIComponent(secId);
            html += '<a class=\"seriesGrid__item\" href=\"' + esc(href) + '\">';
            html += '<img class=\"seriesGrid__img\" src=\"' + esc(thumb96) + '\" srcset=\"' + esc(thumb96) + ' 96w, ' + esc(thumb192) + ' 192w\" sizes=\"(min-width: 1200px) 10vw, (min-width: 700px) 14vw, 22vw\" width=\"96\" height=\"96\" loading=\"lazy\" decoding=\"async\" alt=\"' + esc(title) + '\">';
            html += '<span class=\"sr-only\">' + esc(title) + '</span></a>';
          });
          html += '</div></section>';
        });

        if (html) {
          content.innerHTML = html;
          section.hidden = false;
          scrollToHashTarget();
        }
      })
      .catch(function () {
        section.hidden = true;
      });
  })();
</script>
<script src="{{ '/assets/js/work.js' | relative_url }}"></script>
