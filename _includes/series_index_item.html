{% assign s = include.series %}

{% assign media_base = site.media_base | default: "" %}
{% assign media_prefix = site.media_prefix | default: "/assets" %}
{% assign base = media_base | append: media_prefix | append: "/works/img/" %}

{%- assign series_works = site.works | where: "series_id", s.series_id -%}
{%- assign last_work = series_works | sort: "work_id" | reverse | first -%}
{%- assign single_work = series_works | first -%}

{%- assign target_url = s.url | relative_url -%}
{%- if series_works.size == 1 and single_work and single_work.url -%}
  {%- assign target_url = single_work.url | append: "#from-series-index" | relative_url -%}
{%- endif -%}

{% if last_work and last_work.work_id %}
  {% assign thumb = base | append: last_work.work_id | append: "-thumb-96.webp" %}
  {% assign thumb_out = thumb %}
  {% unless base contains '://' %}{% assign thumb_out = thumb | relative_url %}{% endunless %}
{% else %}
  {% assign thumb_out = "" %}
{% endif %}

<a class="seriesIndexItem" href="{{ target_url }}">
  {% if thumb_out != "" %}
    <img
      class="seriesIndexItem__img"
      src="{{ thumb_out }}"
      alt="{{ s.title | escape }}"
      loading="lazy"
      decoding="async">
  {% endif %}

  <div class="seriesIndexItem__title">{{ s.title | escape }}</div>
</a>
